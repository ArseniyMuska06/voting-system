## üß© –ö–æ–º–º—ñ—Ç–∏

### üü¢ main
> –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–º—ñ—Ç, –∑ —è–∫–æ–≥–æ –≤—Å–µ –ø–æ—á–∞–ª–æ—Å—å.

---

### üÜï –û–Ω–æ–≤–ª–µ–Ω–Ω—è: **voting & users**
- üîÅ –û–Ω–æ–≤–∏–ª–∏—Å—å –º–æ–¥—É–ª—ñ **–≥–æ–ª–æ—Å—É–≤–∞–Ω—å** —ñ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤**  
- üóëÔ∏è –°—Ç–∞—Ä—ñ –¥–∞–Ω—ñ –≤–∏–¥–∞–ª–µ–Ω–æ  
- ‚ö†Ô∏è –î–æ–¥–∞–Ω–æ **–ø–æ–ø–µ—Ä–µ–¥–∂—É–≤–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**:  
  > ¬´–í–∏ –≤–∂–µ –≥–æ–ª–æ—Å—É–≤–∞–ª–∏ –≤ —Ü—å–æ–º—É –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—ñ¬ª

---

### üÜï –û–Ω–æ–≤–ª–µ–Ω–Ω—è: **results & validity for completed polls**
- üìÖ –ó–∞–≤–µ—Ä—à–µ–Ω—ñ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä **–≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å—Å—è –∑–∞ –∞–¥—Ä–µ—Å–æ—é** `/polls/<id>` (–±–µ–∑ 404 –ø—ñ—Å–ª—è `end_at`)
- üìä –î–æ–¥–∞–Ω–æ **–ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤** (–∑–∞–≥–∞–ª—å–Ω–∞ –∫-—Å—Ç—å, –∫-—Å—Ç—å –ø–æ –∫–æ–∂–Ω—ñ–π –æ–ø—Ü—ñ—ó, %)
- üè∑Ô∏è –î–æ–¥–∞—î—Ç—å—Å—è **–±–µ–π–¥–∂ –¥—ñ–π—Å–Ω–æ—Å—Ç—ñ**: ¬´–î—ñ–π—Å–Ω–µ¬ª / ¬´–ù–µ–¥—ñ–π—Å–Ω–µ¬ª (–∑–∞ –∫–≤–æ—Ä—É–º–æ–º)
- üñºÔ∏è –®–∞–±–ª–æ–Ω detail: **—Ñ–æ—Ä–º–∞ —Ö–æ–≤–∞—î—Ç—å—Å—è** –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è, –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è **—Ç–∞–±–ª–∏—Ü—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤**
- üß© –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏:
  - `views.py`: `PollDetailView.get_queryset()` —Ç–µ–ø–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞—î **ACTIVE + COMPLETED** (—ñ `end_at < now`)
  - `views.py`: —É `get_context_data()` –¥–æ–¥–∞—é—Ç—å—Å—è `is_finished`, `totals`, `is_valid`, `validity_note`
  - `services.py` (–Ω–æ–≤–∏–π): `tally_poll(poll)`, `check_validity(poll, total_votes)`
  - `detail.html`: –¥–æ–¥–∞–Ω–æ —Ç–∞–±–ª–∏—Ü—é –∑ –∫-—Å—Ç—é/%, –±–µ–π–¥–∂ –¥—ñ–π—Å–Ω–æ—Å—Ç—ñ

#### üî® –ú—ñ–≥—Ä–∞—Ü—ñ—ó
- (–Ω–µ–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ) –Ø–∫—â–æ –¥–æ–¥–∞–Ω–æ –ø–æ–ª–µ `expected_turnout` –¥–ª—è –∫–≤–æ—Ä—É–º—É:  
  `python manage.py makemigrations polls && python manage.py migrate`

#### ‚úÖ –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏
1) –í –∞–¥–º—ñ–Ω—Ü—ñ –ø–æ—Å—Ç–∞–≤ `status = completed` –∞–±–æ `end_at` —É –º–∏–Ω—É–ª–µ.  
2) –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ –≤ MongoDB —î –≥–æ–ª–æ—Å–∏ –¥–ª—è `poll_id`.  
3) –í—ñ–¥–∫—Ä–∏–π `/polls/<id>` ‚Äî –±–∞—á–∏—à —Ç–∞–±–ª–∏—Ü—é —Ç–∞ –±–µ–π–¥–∂ –¥—ñ–π—Å–Ω–æ—Å—Ç—ñ.

---

## üÜï –û–Ω–æ–≤–ª–µ–Ω–Ω—è: **adminpanel**
- üìÇ **`/adminpanel/`** ‚Äî —Å–ø–∏—Å–æ–∫ **–º–æ—ó—Ö** –æ–ø–∏—Ç—É–≤–∞–Ω—å (—Ñ—ñ–ª—å—Ç—Ä `admin = request.user`), –∫–∞—Ä—Ç–∫–∏ –∑ –Ω–∞–∑–≤–æ—é, –¥–∞—Ç–∞–º–∏ —Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–º.  
- ‚ûï **`/adminpanel/create/`** ‚Äî —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **Poll** + **PollOption** (–º—ñ–Ω—ñ–º—É–º 2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏).  
  –ü–æ–ª—è: `title`, `short_description`, `start_at`, `end_at`, `can_change_vote`, `quorum`, `expected_turnout`, `status`.  
- üîé **`/adminpanel/<id>/`** ‚Äî –ø–µ—Ä–µ–≥–ª—è–¥ —è–∫ —É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –∞–ª–µ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ—é —Å–ª—É–∂–±–æ–≤–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é:
  - üìä –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–ª–æ—Å—ñ–≤ (MongoDB);
  - üßÆ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–ª–æ—Å—ñ–≤ –ø–æ –∫–æ–∂–Ω—ñ–π –æ–ø—Ü—ñ—ó;
  - üè∑Ô∏è –¥—ñ–π—Å–Ω—ñ—Å—Ç—å –∑–∞ –∫–≤–æ—Ä—É–º–æ–º (`total_votes >= ceil(expected_turnout * quorum / 100)`; —è–∫—â–æ `expected_turnout` –Ω–µ –∑–∞–¥–∞–Ω–∏–π ‚Äî –ù/–î);
  - ‚è±Ô∏è –∫–Ω–æ–ø–∫–∞ **¬´–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –∑–∞—Ä–∞–∑¬ª**: –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î `end_at = now` —ñ `status = completed`.
- üß© **–¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏:**
  - `adminpanel/urls.py` ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏: `list`, `create`, `detail`, `finish`;
  - `adminpanel/views.py` ‚Äî `MyPollListView`, `PollCreateView`, `PollAdminDetailView`, `finish_now`;
  - `adminpanel/forms.py` ‚Äî `AdminPollForm` + `OptionFormSet (min_num=2)`;
  - `templates/adminpanel/` ‚Äî `list.html`, `create.html`, `detail.html`;
  - `polls/templatetags/polls_extras.py` ‚Äî —Ñ—ñ–ª—å—Ç—Ä `get_item` (–¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–ª–æ–≤–Ω–∏–∫–∞ –≤ —à–∞–±–ª–æ–Ω—ñ);
  - —á–∏—Ç–∞–Ω–Ω—è –∑ Mongo —á–µ—Ä–µ–∑ `polls.mongo.get_votes_collection()`.
- üß± **–ú—ñ–≥—Ä–∞—Ü—ñ—ó:** –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ (–º–æ–¥–µ–ª—ñ –Ω–µ –∑–º—ñ–Ω—é–≤–∞–ª–∏—Å—è).

### ‚úÖ –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ `/adminpanel/` ‚Äî –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –ª–∏—à–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.  
2. –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ `/adminpanel/create/` (–º—ñ–Ω—ñ–º—É–º 2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏).  
3. –ü—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–æ–º–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏.  
4. –í—ñ–¥–∫—Ä–∏—Ç–∏ `/adminpanel/<id>/` ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:
   - –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–ª–æ—Å—ñ–≤;
   - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≥–æ–ª–æ—Å—ñ–≤ –ø–æ –æ–ø—Ü—ñ—è—Ö;
   - —Å—Ç–∞—Ç—É—Å –¥—ñ–π—Å–Ω–æ—Å—Ç—ñ (–∫–≤–æ—Ä—É–º);
   - –∫–Ω–æ–ø–∫—É **¬´–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –∑–∞—Ä–∞–∑¬ª**.  
5. –ù–∞—Ç–∏—Å–Ω—É—Ç–∏ **¬´–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –∑–∞—Ä–∞–∑¬ª** ‚Äî –º–∞—î –æ–Ω–æ–≤–∏—Ç–∏—Å—è `status = completed` —ñ `end_at ‚âà now`.  
6. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤ MongoDB:
   ```js
   db.votes.countDocuments({ poll_id: <id> })
   db.votes.aggregate([
     { $match: { poll_id: <id> } },
     { $group: { _id: "$option_id", votes: { $sum: 1 } } }
   ])


üìÖ *–î–∞—Ç–∞ –∫–æ–º—ñ—Ç—É:* `2025-10-17`  
üí¨ *–ê–≤—Ç–æ—Ä:* Arsen Muska
